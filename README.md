## Сервис производит регистрацию пользователя и сброс пароля с подтверждением через почту, а также логин, логаут и обновление refresh токена. Используются технологии Spring Security и JWT.

Запускаем через docker compose. Предворительно подключить SMTP и прописать его характеристики в application.properties.
```
spring.mail.host=
spring.mail.port=
spring.mail.username=
spring.mail.password=
```
## Эндпоинты

### Контроллер /auth

### Регистрация пользователя:
Регистрация пользователя разбита на несколько шагов:

1 -  Сервис аутентификации получает данные от frontend, проверяет все данные и после этого отвечает, что все данные валидны и пользователю отправленно письмо для подтверждение учётной записи.

#### Запрос 
POST /auth/reg - создание пользователя

##### Специальные заголовки:

Content-Type : application/json

##### Тело

```
{
  "name": "Иван",
  "surname": "Иванов",
  "email": "Ivan@mail.com",
  "password": "wH&bkYvkV(aD",
  "secondPassword": "wH&bkYvkV(aD"
}
```
#### Ответ
HTTPStatus.ACCEPTED	


##### Специальные заголовки: нет

##### Тело

```
{
    "message": "На почту, которую вы указали отправили email"
}
```



2 -  Пользователь заходит на свою почту и переходит по ссылке в письме, которое он получил от backend. Backend получает запрос от пользователя на подтверждение учетной записи и отправляет ответ frontend о том, что пользователь успешно создан со статусом HttpStatus.CREATED и в теле его id, email, accessToken и refreshToken.

#### Ответ
HTTPStatus.CREATED	


##### Специальные заголовки: нет

##### Тело
```
{
  "id": 19,
  "email": "1Ivan@mail.com",
  "accessToken": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxSXZhbkBtYWlsLmNvbSIsInJvbGVzIjpbIlVTRVIiXSwiZXhwIjoxNjk4NTcyNDM2LCJpYXQiOjE2OTg1NzIzNzZ9.jas6nGzHcURmxWMkoWQzwYs7jinwaq6Lpy-i6QXBbn4",
  "refreshToken": "ece93f58-6990-4c84-828c-c4a372501401"
}
```


##### Возможные коды ответа:

- 201 - пользователь успешно создан
- 202 - данные от пользователя получены
- 400 - в теле запроса ошибка
- 409 - конфликт (например, пользователь с таким email уже существует в БД)
- 500 - неизвестная ошибка сервера

Ответы в случае ошибок:

| Ошибка | Дополнительная информация                           | Ответ                                                                                                                                                               |
|--------|-----------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 400    | Ошибка в JSON                                       | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Неверная структура объекта: проверьте скобки, запятые и названия полей",  <br/>"date": "2023-09-11 19:06:04"<br/>} |
| 400    | Не передано поле Имя/пустое                         | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Имя обязательно для заполнения; ",  <br/>"date": "2023-09-11 19:06:04"<br/>}                                       |
| 400    | Не передано поле Фамилия/пустое                     | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Фамилия не должен быть пустым; ",  <br/>"date": "2023-09-11 19:06:04"<br/>}                                        |
| 400    | Не передано поле Password/пустое                    | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Пароль не должен быть пустым",  <br/>"date": "2023-09-11 19:06:04"<br/>}                                           |
| 400    | Не передано поле Email/пустое                       | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Поле Email обязательно для заполнения; ",  <br/>"date": "2023-09-11 19:06:04"<br/>}                                |
| 409    | Пользователь с указанным  Email <br/>уже есть в БД  | {<br/>"status": "CONFLICT",  <br/>"message": "Эта электронная почта уже существует в базе данных",  <br/>"date": "2023-09-11 19:06:04"<br/>}                        |
| 500    | нет                                                 | {<br/>"status": "INTERNAL_SERVER_ERROR",  <br/>"message": "Неизвестная ошибка сервера",  <br/>"date": "2023-09-11 19:06:04"<br/>}                                   |


Ограничения на длину полей при создании пользователя:

| Поле      | Ограничение                                                                          | Код ответа | Ответ                                                                                             |
|-----------|--------------------------------------------------------------------------------------|------------|----------------------------------------------------------------------------------------------------------------------------------------------|
| name      | Обязательное, не пустое, не более 50 символов                                        | 400        | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Имя должно быть не больше 50 знаков; ",  <br/>"date": "2023-09-11 19:06:04"<br/>}           |
| surname   | Не обязательное, не более 50 символов                                                | 400        | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Фамилия должна быть не больше 50 знаков; ",  <br/>"date": "2023-09-11 19:06:04"<br/>}       |                                      
| password  | Обязательное, не пустое, не более 50 символов                                        | 400        | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Пароль должен быть не больше 50 знаков; ",  <br/>"date": "2023-09-11 19:06:04"<br/>}        |
| email     | Обязательное, не пустое, не более 70 символов, должно соответствовать формату Email  | 400        | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Email должен быть не больше 70 знаков; ",  <br/>"date": "2023-09-11 19:06:04"<br/>}         |


### Login:

Сервис аутентификации получает данные от frontend ( username/password ), проверяет все данные и, если пользователь с такими данными существует, отдаёт в теле ответа его id, email, accessToken и refreshToken.

#### Запрос 
POST /auth/login - логин

##### Специальные заголовки:

Content-Type : application/json

##### Тело

```
{
  "username": "Ivan@mail.com",
  "password": "wH&bkYvkV(aD"
}
```
#### Ответ
HTTPStatus.OK


##### Специальные заголовки: нет

##### Тело

```
{
  "id": 19,
  "email": "1Ivan@mail.com",
  "accessToken": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxSXZhbkBtYWlsLmNvbSIsInJvbGVzIjpbIlVTRVIiXSwiZXhwIjoxNjk4NTcyNDM2LCJpYXQiOjE2OTg1NzIzNzZ9.jas6nGzHcURmxWMkoWQzwYs7jinwaq6Lpy-i6QXBbn4",
  "refreshToken": "ece93f58-6990-4c84-828c-c4a372501401"
}
```
##### Возможные коды ответа:

- 200 - операция прошла успешно
- 400 - в теле запроса ошибка
- 403 - пользователь не подтвердил свою учетную запись
- 404 - пользователь с таким email не найден
- 500 - неизвестная ошибка сервера

Ответы в случае ошибок:

| Ошибка | Дополнительная информация                           | Ответ                                                                                                                                                               |
|--------|-----------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 400    | Ошибка в JSON                                       | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Неверная структура объекта: проверьте скобки, запятые и названия полей",  <br/>"date": "2023-09-11 19:06:04"<br/>} |
| 400    | Не передано поле Password/пустое                    | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Пароль не должен быть пустым",  <br/>"date": "2023-09-11 19:06:04"<br/>}                                           |
| 400    | Не передано поле Email/пустое                       | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Поле Email обязательно для заполнения; ",  <br/>"date": "2023-09-11 19:06:04"<br/>}                                |
| 403    | Пользователь не подтвердил свою учетную запись      | {<br/>"status": "FORBIDDEN",  <br/>"message": "Пользователь не подтвердил свою учетную запись",  <br/>"date": "2023-09-11 19:06:04"<br/>}                           |
| 404    | Пользователь с таким email не найден                | {<br/>"status": "NOT_FOUND",  <br/>"message": "Пользователь с таким email не найден",  <br/>"date": "2023-09-11 19:06:04"<br/>}                                     |
| 500    | Нет                                                 | {<br/>"status": "INTERNAL_SERVER_ERROR",  <br/>"message": "Неизвестная ошибка сервера",  <br/>"date": "2023-09-11 19:06:04"<br/>}                                   |


Ограничения на длину полей при создании пользователя:

| Поле      | Ограничение                                                                                | Код ответа | Ответ                                                                                                                                        |
|-----------|--------------------------------------------------------------------------------------------|------------|----------------------------------------------------------------------------------------------------------------------------------------------|                   
| password  | Обязательное, не пустое, не более 50 символов                                              | 400        | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Пароль должен быть не больше 50 знаков; ",  <br/>"date": "2023-09-11 19:06:04"<br/>}        |
| email     | Обязательное, не пустое, не более 70 символов, должно соответствовать фоормату  Email:     | 400        | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Email должен быть не больше 70 знаков; ",  <br/>"date": "2023-09-11 19:06:04"<br/>}         |

### Logout:

Сервис аутентификации получает accessToken от frontend и проверяет, если токен валидный, то удаляет refreshToken из базы данных. Frontend в свою очередь удаляет все данные о пользователе.

#### Запрос 
GET /auth/logout

##### Специальные заголовки:
Authorization :
Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJxZGFuaWxAbWFpbC5jb20iLCJyb2xlcyI6WyJVU0VSIl0sImV4cCI6MTY5ODU4MTA4NCwiaWF0IjoxNjk4NTgwOTY0fQ.8y0_-EdBws8cLirzP3-D8NKqkUQnhZUlbmlPbVTDoXo

#### Ответ
HTTPStatus.OK

### Не подтверждённая учетная запись:

Если по каким - то причинам пользователь не подтвердил свою учетную запись при регистрации ( не дошло письмо, не нашел, удалил ), то эту процедуру можно пройти ещё раз. Как и при регистрации это займет несколько шагов.

1  -  Сервис аутентификации получает от frontend email и отправляет пользователю письмо для подтверждение учётной записи.


#### Запрос 
POST /auth/activate

##### Специальные заголовки:
Content-Type : application/json
##### Тело

```
{
    "email":"Ivan@mail.com"
}
```

#### Ответ
HTTPStatus.ACCEPTED	


##### Специальные заголовки: нет

##### Тело

```
{
    "message": "На почту, которую вы указали отправили email"
}
```
2 -  Пользователь заходит на свою почту и переходит по ссылке в письме, которое он получил от backend. Backend получает запрос от пользователя на подтверждение учетной записи и отпровляет ответ frontend о том, что пользователь успешно создан со статусом HttpStatus.CREATED и в теле его id, email, accessToken и refreshToken.

#### Ответ
HTTPStatus.CREATED	


##### Специальные заголовки: нет

##### Тело
```
{
  "id": 19,
  "email": "1Ivan@mail.com",
  "accessToken": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxSXZhbkBtYWlsLmNvbSIsInJvbGVzIjpbIlVTRVIiXSwiZXhwIjoxNjk4NTcyNDM2LCJpYXQiOjE2OTg1NzIzNzZ9.jas6nGzHcURmxWMkoWQzwYs7jinwaq6Lpy-i6QXBbn4",
  "refreshToken": "ece93f58-6990-4c84-828c-c4a372501401"
}
```


##### Возможные коды ответа:

- 201 - пользователь успешно создан
- 202 - данные от пользователя получены
- 400 - в теле запроса ошибка
- 404 - пользователь с таким email не найден
- 500 - неизвестная ошибка сервера

| Ошибка | Дополнительная информация                           | Ответ                                                                                                                                                               |
|--------|-----------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 400    | Ошибка в JSON                                       | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Неверная структура объекта: проверьте скобки, запятые и названия полей",  <br/>"date": "2023-09-11 19:06:04"<br/>} |
| 400    | Не передано поле Email/пустое                       | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Поле Email обязательно для заполнения; ",  <br/>"date": "2023-09-11 19:06:04"<br/>}                                |
| 404    | Пользователь с таким email не найден                | {<br/>"status": "NOT_FOUND",  <br/>"message": "Пользователь с таким email не найден",  <br/>"date": "2023-09-11 19:06:04"<br/>}                                     |
| 500    | нет                                                 | {<br/>"status": "INTERNAL_SERVER_ERROR",  <br/>"message": "Неизвестная ошибка сервера",  <br/>"date": "2023-09-11 19:06:04"<br/>}                                   |


### Сброс пароля:

Если пользователь не помнит свой пароль, то его можно сбросить. Как и при регистрации это займет несколько шагов.

1  -  Сервис аутентификации получает от frontend email и отправляет пользователю письмо для подтверждение сброса пароля.


#### Запрос 
POST /auth/activate

##### Специальные заголовки:
Content-Type : application/json
##### Тело

```
{
    "email":"Ivan@mail.com"
}
```

#### Ответ
HTTPStatus.ACCEPTED	


##### Специальные заголовки: нет

##### Тело

```
{
    "message": "На почту, которую вы указали отправили email"
}
```
2 -  Пользователь заходит на свою почту и переходит по ссылке в письме, которое он получил от backend. Backend получает запрос от пользователя на подтверждение сброса пароля и отпровляет ответ frontend о том, что пользователь успешно аутентифицирован со статусом HttpStatus.CREATED и в теле его id, email, accessToken и refreshToken.

#### Ответ
HTTPStatus.CREATED	


##### Специальные заголовки: нет

##### Тело
```
{
  "id": 19,
  "email": "1Ivan@mail.com",
  "accessToken": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxSXZhbkBtYWlsLmNvbSIsInJvbGVzIjpbIlVTRVIiXSwiZXhwIjoxNjk4NTcyNDM2LCJpYXQiOjE2OTg1NzIzNzZ9.jas6nGzHcURmxWMkoWQzwYs7jinwaq6Lpy-i6QXBbn4",
  "refreshToken": "ece93f58-6990-4c84-828c-c4a372501401"
}
```

3  -  Frontend, получив от backend accessToken, делает запрос, помещая в json password и secondPassword


#### Запрос 
POST /auth/reset

##### Специальные заголовки:
Content-Type : application/json

Authorization :
Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJxZGFuaWxAbWFpbC5jb20iLCJyb2xlcyI6WyJVU0VSIl0sImV4cCI6MTY5ODU4MTA4NCwiaWF0IjoxNjk4NTgwOTY0fQ.8y0_-EdBws8cLirzP3-D8NKqkUQnhZUlbmlPbVTDoXo
##### Тело

```
{
  "password": "1qazXSW@",
  "secondPassword": "1qazXSW@"
}
```

#### Ответ
HTTPStatus.OK


##### Специальные заголовки: нет

##### Тело

```
{
    "message": "Пароль был успешно изменён"
}
```




##### Возможные коды ответа:

- 200 - операция прошла успешно
- 202 - данные от пользователя получены
- 400 - в теле запроса ошибка
- 404 - пользователь с таким email не найден
- 500 - неизвестная ошибка сервера

| Ошибка | Дополнительная информация                           | Ответ                                                                                                                                                               |
|--------|-----------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 400    | Ошибка в JSON                                       | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Неверная структура объекта: проверьте скобки, запятые и названия полей",  <br/>"date": "2023-09-11 19:06:04"<br/>} |
| 400    | Пароли не совпадают                                 | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Пароли не совпадают",  <br/>"date": "2023-09-11 19:06:04"<br/>}                                                    |
| 400    | Не передано поле Email/пустое                       | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Поле Email обязательно для заполнения; ",  <br/>"date": "2023-09-11 19:06:04"<br/>}                                |
| 404    | Пользователь с таким email не найден                | {<br/>"status": "NOT_FOUND",  <br/>"message": "Пользователь с таким email не найден",  <br/>"date": "2023-09-11 19:06:04"<br/>}                                     |
| 500    | Нет   


### Обновить access token:


Сервис аутентификации получает от frontend refresh token.


#### Запрос 
POST /auth/refresh

##### Специальные заголовки:
Content-Type : application/json
##### Тело

```
{
  "refreshToken": "ece93f58-6990-4c84-828c-c4a372501401"
}
```

#### Ответ
HTTPStatus.OK	


##### Специальные заголовки: нет

##### Тело

```
{
  "id": 19,
  "email": "1Ivan@mail.com",
  "accessToken": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxSXZhbkBtYWlsLmNvbSIsInJvbGVzIjpbIlVTRVIiXSwiZXhwIjoxNjk4NTcyNjQyLCJpYXQiOjE2OTg1NzI1ODJ9.fWnaWqiEeF3RHkh_jpNGXutcGLs1rrI780z_UpYPopo"
}
```
##### Возможные коды ответа:

- 200 - операция прошла успешно
- 400 - в теле запроса ошибка
- 404 - refresh tоken не найден (истек срок действия / не сушествовало) 
- 500 - неизвестная ошибка сервера

| Ошибка | Дополнительная информация                           | Ответ                                                                                                                                                               |
|--------|-----------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 400    | Ошибка в JSON                                       | {<br/>"status": "BAD_REQUEST",  <br/>"message": "Неверная структура объекта: проверьте скобки, запятые и названия полей",  <br/>"date": "2023-09-11 19:06:04"<br/>} |
| 404    | Не валидный refresh токен                           | {<br/>"status": "NOT_FOUND",  <br/>"message": "refresh tоken не найден (истек срок действия/ не сушествовало) ",  <br/>"date": "2023-09-11 19:06:04"<br/>}          |
| 500    | Нет   



